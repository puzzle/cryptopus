{{#if this.record.isFullyLoaded}}
  <BsModal class="modal_account ignore-footer-smartphone" @onHide={{action this.abort}} @renderInPlace="true" @size="lg"
           as |Modal|>
    <Modal.header>
      <h3 class="modal-title">{{@title}}</h3>
    </Modal.header>
    <Modal.body>
      <div class="container-fluid">
        <BsForm @model={{this.changeset}} as |form|>
          <div class="encryptable-form-name">
            <div class="row">
              {{#if this.errors}}
                <div class="col-12 order-1">
                  {{#each this.errors as |error|}}
                    <div class="alert alert-danger modal-alert">
                      {{#if (eq error.detail "At least one attribute must be set")}}
                        {{t "validations.attributes.at_least_one_attribute"}}
                      {{else if (eq error.detail "has already been taken")}}
                        {{t "validations.name.duplicate_name"}}
                      {{else}}
                        {{t "error"}}
                      {{/if}}
                    </div>
                  {{/each}}
                </div>
              {{/if}}
              <div class="col-md-6 order-2">
                <form.group class="col-md-12">
                  <form.element id="encryptable-form-accountname" @property="name" @label={{t
                    "helpers.label.encryptable/credentials.accountname"}}
                                class={{if this.changeset.error.name.validation
                                           "invalid-input-name"}}
                                @customError={{t (validation-error-key this.changeset.error.name.validation)}} as |el|>
                    <el.control autocomplete="off" @name="name" tabindex="1"></el.control>
                  </form.element>
                </form.group>
              </div>
              <div class="col-md-6 order-2">
                <div class="form-group col-md-12" id="team-power-select">
                  <form.element id="encryptable-form-team" @label={{t "team"}} @controlType="power-select"
                                @options={{this.assignableTeams}} @value={{this.selectedTeam}}
                                @customError={{t (validation-error-key this.changeset.error.team.validation)}} as |el|>
                    <el.control class={{if this.changeset.error.team.validation "invalid-input-ps"}} @placeholder={{t
                      "encryptable/credentials.edit.team_placeholder"}}
                                @renderInPlace={{true}} @onChange={{this.setSelectedTeam}} as |team|>
                      {{#if team.isPersonalTeam }}
                        {{this.userService.username}}
                      {{else}}
                        {{team.name}}
                      {{/if}}
                    </el.control>
                  </form.element>
                </div>
                <div class="form-group col-md-12" id="folder-power-select">
                  <form.element id="encryptable-form-folder" if="encryptable-form-folder"
                                @options={{this.availableFolders}} @label={{t "folder"}} @controlType="power-select"
                                @value={{this.changeset.folder}}
                                @searchEnabled={{true}} @allowClear={{true}} @searchField={{"name"}}
                                @customError={{t (validation-error-key this.changeset.error.folder.validation)}} as
                                |el|>
                    <el.control class={{if this.changeset.error.folder.validation "invalid-input-ps"}}
                                @disabled={{this.isFolderDropdownDisabled}}
                                @placeholder={{t "encryptable/credentials.edit.folder_placeholder"}}
                                @renderInPlace={{true}} @onChange={{this.setFolder}} as |folder|>
                      {{folder.name}}
                    </el.control>
                  </form.element>
                </div>
              </div>
            </div>
            <form.group class="col-md-12">
              <form.element id="encryptable-form-description" @label={{t "description"}} @property="description"
                            @controlType="textarea"
                            class="{{if
                              this.changeset.error.description.validation "invalid-input"}} vertical-resize"
                            customError={{t
                (validation-error-key this.changeset.error.description.validation)}} as |el|>
                <el.control tabindex="7"></el.control>
              </form.element>
            </form.group>
          </div>
          <div class="encryptable-form-attributes">
            <div class="row">
              {{#if this.isUsernameFieldActive}}
                <div id="username-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12">
                    <form.element @label={{t "username"}} id="username" class={{if
                      this.changeset.error.cleartextUsername.validation "invalid-input-name"}}
                                  @property="cleartextUsername" @customError={{t
                      (validation-error-key this.changeset.error.cleartextUsername.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control @name="cleartextUsername" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "username")}}>
                    <img id="remove-username-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                </div>
              {{/if}}
              {{#if this.isPasswordFieldActive}}
                <div id="password-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12 secret password-field">
                    <form.element @label={{t "password"}} id="cleartext-password" class={{if
                      this.changeset.error.cleartextPassword.validation "invalid-input-name"}}
                                  @property="cleartextPassword" @customError={{t
                      (validation-error-key this.changeset.error.cleartextPassword.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control type="password" autocomplete="off" @name="cleartextPassword"
                                  tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "password")}}>
                    <img id="remove-password-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                  <PasswordStrengthMeter class="col-12 col-lg-9 px-0 mb-2 mb-md-0 ml-3"
                                         @password={{this.changeset.cleartextPassword}}/>
                  <div></div>
                  <button class="btn btn-secondary btn-block col-lg-7 mb-md-4 ml-3 mt-2" {{on "click"
                                                                                              this.setRandomPassword}}
                          tabindex="4">
                    {{t "encryptable/credentials.edit.random_password"}}
                  </button>
                </div>
              {{/if}}
              {{#if this.isTokenFieldActive}}
                <div id="token-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12">
                    <form.element @label={{t "token"}} id="token" class={{if
                      this.changeset.error.cleartextToken.validation "invalid-input-name"}}
                                  @property="cleartextToken" @customError={{t
                      (validation-error-key this.changeset.error.cleartextToken.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control @name="cleartextToken" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "token")}}>
                    <img id="remove-token-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                </div>
              {{/if}}
              {{#if this.isPinFieldActive}}
                <div id="pin-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12">
                    <form.element @label={{t "pin"}} id="pin" class={{if
                      this.changeset.error.cleartextPin.validation "invalid-input-name"}}
                                  @property="cleartextPin" @customError={{t
                      (validation-error-key this.changeset.error.cleartextPin.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control @name="cleartextPin" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "pin")}}>
                    <img id="remove-pin-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                </div>
              {{/if}}
              {{#if this.isEmailFieldActive}}
                <div id="email-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12">
                    <form.element @label={{t "email"}} id="email" class={{if
                      this.changeset.error.cleartextEmail.validation "invalid-input-name"}}
                                  @property="cleartextEmail" @customError={{t
                      (validation-error-key this.changeset.error.cleartextEmail.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control @name="cleartextEmail" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "email")}}>
                    <img id="remove-email-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                </div>
              {{/if}}
              {{#if this.isCustomAttrFieldActive}}
                <div id="custom-attr-field" class="col-md-6 pt-2 encryptable-form-field border-1 border border-mute">
                  <form.group class="col-md-12">
                    <form.element @label={{t "labelCustomAttr"}} id="labelCustomAttr" class={{if
                      this.changeset.error.cleartextCustomAttr.validation "invalid-input-name"}}
                                  @property="label" @customError={{t
                      (validation-error-key this.changeset.error.label.validation)}} as |el|>
                      <el.control @name="label" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                  <button class="btn btn-danger d-inline-block p-1 delete-field" {{on "click"
                                                                                      (action "removeField" "customAttr")}}>
                    <img id="remove-customAttr-field-button" class="d-inline" src="/assets/images/delete-white.svg"
                         alt="delete attribute field">
                  </button>
                  <form.group class="col-md-12">
                    <form.element @label={{t "valueCustomAttr"}} id="valueCustomAttr" class={{if
                      this.changeset.error.cleartextCustomAttr.validation "invalid-input-name"}}
                                  @property="value" @customError={{t
                      (validation-error-key this.changeset.error.value.validation)}} as |el|>
                      <a>
                        <BsTooltip @title={{t "encryptable/credentials.form.encryptedField"}} @delayShow="300"/>
                        <img class="d-inline-block position-absolute encrypted-icon"
                             src="/assets/images/encrypted_small.svg" alt="encrypted value">
                      </a>
                      <el.control @name="value" tabindex="2"></el.control>
                    </form.element>
                  </form.group>
                </div>
              {{/if}}
            </div>
            {{#if (gt this.items.length 0)}}
              <div class="ml-3 mb-3">{{t "additionalField"}}</div>
              {{!-- Add property value and action to overwrite it because jquery can't access this.element from glimmer components --}}
              <PowerSelect
                id="add-field-dropdown"
                @options={{this.items}}
                @placeholder={{t "additionalFieldPlaceholder"}}
                @renderInPlace={{true}}
                @selected={{this.selected}}
                @onChange={{fn (mut this.selected)}} as |item|>
                {{t item}}
              </PowerSelect>
              <button class="btn btn-success d-inline-block p-1 ml-2 add-field" {{on "click" (action "addField")}} >
                <img id="add-field-button" class="d-inline" src="/assets/images/plus-white.svg"
                     alt="add attribute field">
              </button>
            {{/if}}
          </div>
        </BsForm>
      </div>
    </Modal.body>
    <Modal.footer>
      <BsButton id="encryptable-form-save-button" @onClick={{action this.submit this.changeset}} @type="primary">{{t "save"}}</BsButton>
      <BsButton id="encryptable-form-close-button" @onClick={{action this.abort}} @type="secondary">{{t "close"}}</BsButton>
    </Modal.footer>
  </BsModal>
{{/if}}