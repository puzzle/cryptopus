version: '3.4'

services:
  rails:
    image: cryptopus-dev/rails
    user: "${UID:-1000}"
    tty: true
    stdin_open: true
    environment:
      RAILS_DB_ADAPTER: 'postgresql'
      RAILS_DB_HOST: 'cryptopus-postgres'
      RAILS_DB_NAME: 'cryptopus-postgres-db'
      RAILS_DB_USERNAME: 'postgres'
      RAILS_DB_PASSWORD: 'password'
      RAILS_DB_PORT: 5432
    build:
      context: ./config/docker/development
      dockerfile: Rails.dockerfile
    ports:
      - 3000:3000
    volumes:
      - ./:/myapp
      - ./tmp/seed:/seed
      - ./config/docker/development/rails/bin/prepare-frontend.sh:/myapp/bin/prepare-frontend.sh:ro
      - ./config/docker/development/home/rails:/home/developer
      - bundler_cache:/opt/bundle
      - /tmp/.X11-unix:/tmp/.X11-unix
  ember:
    image: cryptopus-dev/ember
    tty: true
    user: "${UID:-1000}"
    stdin_open: true
    build:
      context: ./config/docker/development
      dockerfile: Ember.dockerfile
    volumes:
      - ./frontend:/myapp
      - ./tmp/bash_history:/root/.bash_history
      - yarn_cache:/myapp/node_modules
    tmpfs:
      - /myapp/tmp
    ports:
      - "4200:4200"
      - "7020:7020"
      - "7357:7357"
  cryptopus-postgres:
    image: postgres:12.10
    container_name: cryptopus-postgres
    environment:
      POSTGRES_PASSWORD: password
    restart: always
    ports:
      - "5432:5432"
    volumes:
      - cryptopus-postgres:/var/lib/postgres
volumes:
  bundler_cache:
  yarn_cache:
  cryptopus-postgres:
