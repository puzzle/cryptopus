language: ruby
cache: bundler
addons:
  firefox: 45.0
env:
  global:
   - HEADLESS=true
rvm:
 - 2.2

before_install:
 - sudo service mysql restart
install:
 - bundle install --path vendor/bundle
before_script:
 - bundle exec rake db:create
 - bundle exec rake db:setup
 - bundle exec rake db:migrate
 - bundle exec rake db:seed
 - bundle exec rake geo:fetch
 - "export DISPLAY=:99.0"
 - "sh -e /etc/init.d/xvfb start"
 - sleep 3 # give xvfb some time to start
script:
 - bundle --deployment
 - bundle exec rake ci --trace
 - bundle exec rake test:features
